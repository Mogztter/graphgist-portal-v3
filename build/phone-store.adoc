= Phone store =

== Model
image::http://s29.postimg.org/7q5lb5o1x/Phone_store.jpg[]

The domain model is fairly simple and straight forward.
Each :Phone node is connected to at least one :Manufacturer, :Type, :OS and :Category node.
Different 'weight' were given to different type of relation between these nodes.
These 'weight' are the factors that will affect the ranking of the recommendation.
It rates what people are more concerned with when considering for a new phone.

The current factor for the relations are as below

. :Manufacturer weighted at 1.0

. :Category weighted at 2.0

. :Type weighted at 1.2

. :OS weighted at 1.8


The system will try to guess what users are more interested in when doing recommendation.
In the current implementation, we assumed that the :Category and :OS have the highest concern.
The algorithm can be improved by tweaking the weight of the relations.


//hide
//setup
[source,cypher]
----

CREATE (iPhone5s:Phone {name:'iPhone 5S', quantity:0})
CREATE (iPhone5c:Phone {name:'iPhone 5C', quantity:1})
CREATE (iPhone5:Phone {name:'iPhone 5', quantity:5})
CREATE (iPhone4s:Phone {name:'iPhone 4S', quantity:2})
CREATE (iPhone4:Phone {name:'iPhone 4', quantity:0})


CREATE (lumia1520:Phone {name:'Lumia 1520', quantity:3})
CREATE (lumia900:Phone {name:'Lumia 900', quantity:7})
CREATE (nokia111:Phone {name:'Nokia 111', quantity:4})

CREATE (galaxy4:Phone {name:'Samsung Galaxy 4', quantity:10})
CREATE (note3:Phone {name:'Samsung Note 3', quantity:9})
CREATE (ativSNeo:Phone {name:'Samsung ATIV S Neo', quantity:2})
CREATE (c3590:Phone {name:'Samsung C3590', quantity:5})

CREATE (htcOne:Phone {name:'HTC One', quantity:10})
CREATE (htcMozart:Phone {name:'HTC Mozart', quantity:0})
CREATE (htcChaCha:Phone {name:'HTC ChaCha', quantity:0})
CREATE (htcDesire:Phone {name:'HTC Desire', quantity:2})
CREATE (htcDesireZ:Phone {name:'HTC Desire Z', quantity:2})


CREATE (smartphone:Category {name:'Smartphone'})
CREATE (featurePhone:Category {name:'Feature Phone'})

CREATE (qwerty:Type {name:'Qwerty'})
CREATE (numpad:Type {name:'Numpad'})
CREATE (touchscreen:Type {name:'Touch Screen'})

CREATE (iOS:OS {name:'iOS'})
CREATE (android:OS {name:'Android'})
CREATE (windowsPhone:OS {name:'Windows phone'})
CREATE (others:OS {name:'Others'})

CREATE (nokia:Manufacturer {name:'Nokia'})
CREATE (samsung:Manufacturer {name:'Samsung'})
CREATE (apple:Manufacturer {name:'Apple'})
CREATE (htc:Manufacturer {name:'HTC'})

create (apple)-[:MADE {weight:1.0}]->(iPhone)5s
create (apple)-[:MADE {weight:1.0}]->(iPhone)5c
create (apple)-[:MADE {weight:1.0}]->(iPhone)5
create (apple)-[:MADE {weight:1.0}]->(iPhone)4s
create (apple)-[:MADE {weight:1.0}]->(iPhone)4

create (nokia)-[:MADE {weight:1.0}]->(lumia)1520
create (nokia)-[:MADE {weight:1.0}]->(lumia)900
create (nokia)-[:MADE {weight:1.0}]->(nokia)111

create (samsung)-[:MADE {weight:1.0}]->(galaxy)4
create (samsung)-[:MADE {weight:1.0}]->(note)3
create (samsung)-[:MADE {weight:1.0}]->(ativSNeo)
create (samsung)-[:MADE {weight:1.0}]->(c)3590

create (htc)-[:MADE {weight:1.0}]->(htcOne)
create (htc)-[:MADE {weight:1.0}]->(htcMozart)
create (htc)-[:MADE {weight:1.0}]->(htcChaCha)
create (htc)-[:MADE {weight:1.0}]->(htcDesire)
create (htc)-[:MADE {weight:1.0}]->(htcDesireZ)

create (iPhone5s)-[:IS {weight:2.0}]->(smartphone)
create (iPhone5c)-[:IS {weight:2.0}]->(smartphone)
create (iPhone5)-[:IS {weight:2.0}]->(smartphone)
create (iPhone4s)-[:IS {weight:2.0}]->(smartphone)
create (iPhone4)-[:IS {weight:2.0}]->(smartphone)

create (lumia1520)-[:IS {weight:2.0}]->(smartphone)
create (lumia900)-[:IS {weight:2.0}]->(smartphone)
create (nokia111)-[:IS {weight:2.0}]->(featurePhone)

create (galaxy4)-[:IS {weight:2.0}]->(smartphone)
create (note3)-[:IS {weight:2.0}]->(smartphone)
create (ativSNeo)-[:IS {weight:2.0}]->(smartphone)
create (c3590)-[:IS {weight:2.0}]->(featurePhone)

create (htcOne)-[:IS {weight:2.0}]->(smartphone)
create (htcMozart)-[:IS {weight:2.0}]->(smartphone)
create (htcChaCha)-[:IS {weight:2.0}]->(smartphone)
create (htcDesire)-[:IS {weight:2.0}]->(smartphone)
create (htcDesireZ)-[:IS {weight:2.0}]->(smartphone)


create (iPhone5s)-[:TYPE {weight:1.2}]->(touchscreen)
create (iPhone5c)-[:TYPE {weight:1.2}]->(touchscreen)
create (iPhone5)-[:TYPE {weight:1.2}]->(touchscreen)
create (iPhone4s)-[:TYPE {weight:1.2}]->(touchscreen)
create (iPhone4)-[:TYPE {weight:1.2}]->(touchscreen)

create (lumia1520)-[:TYPE {weight:1.2}]->(touchscreen)
create (lumia900)-[:TYPE {weight:1.2}]->(touchscreen)
create (nokia111)-[:TYPE {weight:1.2}]->(numpad)

create (galaxy4)-[:TYPE {weight:1.2}]->(touchscreen)
create (note3)-[:TYPE {weight:1.2}]->(touchscreen)
create (ativSNeo)-[:TYPE {weight:1.2}]->(touchscreen)
create (c3590)-[:TYPE {weight:1.2}]->(numpad)

create (htcOne)-[:TYPE {weight:1.2}]->(touchscreen)
create (htcMozart)-[:TYPE {weight:1.2}]->(touchscreen)
create (htcChaCha)-[:TYPE {weight:1.2}]->(touchscreen)
create (htcChaCha)-[:TYPE {weight:1.2}]->(qwerty)
create (htcDesire)-[:TYPE {weight:1.2}]->(touchscreen)
create (htcDesireZ)-[:TYPE {weight:1.2}]->(touchscreen)
create (htcDesireZ)-[:TYPE {weight:1.2}]->(qwerty)


create (iPhone5s)-[:RUNNING_ON {weight:1.8}]->(iOS)
create (iPhone5c)-[:RUNNING_ON {weight:1.8}]->(iOS)
create (iPhone5)-[:RUNNING_ON {weight:1.8}]->(iOS)
create (iPhone4s)-[:RUNNING_ON {weight:1.8}]->(iOS)
create (iPhone4)-[:RUNNING_ON {weight:1.8}]->(iOS)


create (lumia1520)-[:RUNNING_ON {weight:1.8}]->(windowsPhone)
create (lumia900)-[:RUNNING_ON {weight:1.8}]->(windowsPhone)
create (nokia111)-[:RUNNING_ON {weight:1.8}]->(others)

create (galaxy4)-[:RUNNING_ON {weight:1.8}]->(android)
create (note3)-[:RUNNING_ON {weight:1.8}]->(android)
create (ativSNeo)-[:RUNNING_ON {weight:1.8}]->(windowsPhone)
create (c3590)-[:RUNNING_ON {weight:1.8}]->(others)

create (htcOne)-[:RUNNING_ON {weight:1.8}]->(android)
create (htcMozart)-[:RUNNING_ON {weight:1.8}]->(windowsPhone)
create (htcChaCha)-[:RUNNING_ON {weight:1.8}]->(android)
create (htcDesire)-[:RUNNING_ON {weight:1.8}]->(android)
create (htcDesireZ)-[:RUNNING_ON {weight:1.8}]->(android)

RETURN *
----


== Find all HTC phones
[source,cypher]
----
MATCH (htc:Manufacturer{name:'HTC'})-[:MADE]->(p:Phone)
RETURN p.name as Phone
----

//table


== Find all smartphones
[source,cypher]
----
MATCH (p:Phone)-[:IS]->(t:Category {name:'Smartphone'})
RETURN p.name as Phone
----

//table


== Find all manufacturers and their android phones models
[source,cypher]
----
MATCH (m:Manufacturer)-[:MADE]->(p:Phone)-[:RUNNING_ON]->(o:OS {name:'Android'})
RETURN m.name as Manufacturer, p.name as Phone
----

//table


== Find qwerty & touchscreen capable phones (in stock)
[source,cypher]
----
MATCH (t:Type { name: "Touch Screen" })<-[:TYPE]-(p:Phone)-[:TYPE]->(q:Type { name: "Qwerty" })
WHERE p.quantity > 0
RETURN p.name as Phone
----

//table


== Find all phones (out of stock)
[source,cypher]
----
MATCH (m:Manufacturer)-[:MADE]->(p:Phone)
WHERE p.quantity = 0
RETURN m.name as Manufacturer, p.name as Phone
----

//graph


== Phone recommendation (out of stock)
Below shows simple recommendation boost based on 3 factors: Operating System, Category & Manufacturer.
Please feel free to play around with the blow cypher query by changing the WHERE CLAUSE 'p.name'

[source,cypher]
----
MATCH (p:Phone),(others:Phone)<-[:MADE]-(m:Manufacturer)
WHERE p.name = 'Lumia 1520' AND others.quantity > 0
OPTIONAL MATCH (m:Manufacturer)-[r1:MADE]->(p:Phone)
OPTIONAL MATCH (p:Phone)-[:IS]->(t:Category)<-[r2:IS]-(others:Phone)
OPTIONAL MATCH (p:Phone)-[:RUNNING_ON]->(:OS)<-[r3:RUNNING_ON]-(others:Phone)
RETURN m.name AS Manufacturer, others.name AS Phone,
coalesce(r1.weight,0.8)+ coalesce(r2.weight,0.9)+ coalesce(r3.weight,0.7) AS Rank
ORDER BY Rank DESC
----

//table

In the above example it tried to guess what are the best alternatives phones that can be suggested to the user.


